!function(){"use strict";class e{constructor(e,t,s,n,r,i){let{name:o,link:a,likes:l,_id:u,owner:c}=e;this._owner=c,this._name=o,this._link=a,this._templateSelector=t,this._handleCardClick=s,this._handleDeleteClick=n,this._handleHeartClick=r,this._cardId=u,this._userId=i,this._likes=l,this._likesNum=l?l.length:0}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}_handleImageClick(e){e.preventDefault(),this._handleCardClick(e.target.src,this._name)}_handleDeleteIconClick(e){this._handleDeleteClick(e,this._cardId)}_handleLikeClick(e){e.preventDefault(),e.target.classList.toggle("element__like_active"),this._handleHeartClick(this._cardId,!e.target.classList.contains("element__like_active"),this._updateCard.bind(this))}_setEventListeners(){this._imageElement.addEventListener("click",(e=>this._handleImageClick(e))),this._deleteElement.addEventListener("click",(e=>{e.preventDefault(),this._handleDeleteIconClick(this._deleteElement.closest(".element"))})),this._likes.forEach((e=>{e._id===this._userId&&this._likeElement.classList.add("element__like_active")})),this._likeElement.addEventListener("click",(e=>this._handleLikeClick(e)))}getCard(){return this._element=this._getTemplate(),this._imageElement=this._element.querySelector(".element__image"),this._nameElement=this._element.querySelector(".element__box").querySelector(".element__name"),this._deleteElement=this._element.querySelector(".element__delete-button"),this._likeElement=this._element.querySelector(".element__like"),this._likesNumElement=this._element.querySelector(".element__count"),this._userId===this._owner._id&&(this._deleteElement.style.visibility="visible"),this._imageElement.src=this._link,this._imageElement.alt=this._name,this._nameElement.textContent=this._name,this._likesNumElement.textContent=this._likesNum,this._setEventListeners(),this._element}_updateCard(e){this._likesNum=e,this._likesNumElement.textContent=this._likesNum}}class t{constructor(e,t){this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e,t){this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),this._errorElement.textContent=t,e.classList.add(this._inputErrorClass)}_hideInputError(e){this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),this._errorElement.textContent="",e.classList.remove(this._inputErrorClass)}disableButton(){this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._inactiveButtonClass)}_enableButton(){this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._inactiveButtonClass)}_checkIfValid(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_checkIfFormValid(){return this._inputsList.every((e=>e.validity.valid&&""!==e.value))}_toggleSubmitBtnState(){this._checkIfFormValid()?this._enableButton():this.disableButton()}_setEventListeners(){this._inputsList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._inputsList.forEach((e=>{e.addEventListener("input",(t=>{t.preventDefault(),this._toggleSubmitBtnState(),this._checkIfValid(e)}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e,t){let{items:s,renderer:n}=e;this._items=s,this._renderer=n,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e){n(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.closePopup()})),n(this,"_handleOverlayClick",(e=>{e.target.classList.contains("popup")&&this.closePopup()})),this._popup=document.querySelector(e)}closePopup(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("click",this._handleOverlayClick)}openPopup(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("click",this._handleOverlayClick)}_addCloseOnClickEvent(){this._closeBtn=this._popup.querySelector(".popup__close"),this._closeBtn.addEventListener("click",(e=>{e.preventDefault(),this.closePopup()}))}setEventListeners(){this._addCloseOnClickEvent()}}class i extends r{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._buttonValue=this._popup.querySelector(".popup__button").value}_getInputValues(){return this._inputList=this._popup.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this.renderLoading(!0),this._handleFormSubmit(this._getInputValues(),this._element,this._id)}))}setSubmitAction(e,t){this._element=e,this._id=t}renderLoading(e){this._popup.querySelector(".popup__button").value=e?"Saving...":this._buttonValue}closePopup(){super.closePopup(),this._form.reset()}}const o=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),l=document.querySelector(".popup__input_type_name"),u=document.querySelector(".popup__input_type_hobby"),c=document.querySelector(".popup__form_type_profile"),h=document.querySelector(".popup__form_type_card"),_=document.querySelector(".popup__form_type_avatar"),p=(document.querySelector(".profile__name"),document.querySelector(".profile__interest"),document.querySelector(".profile__overlay-container")),d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},m=new class{constructor(e){let{baseUrl:t,headers:s}=e;this.url=t,this.headers=s}loadUserInfo(){return fetch("".concat(this.url,"/users/me"),{headers:{authorization:this.headers.authorization}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}getInitialCards(){return fetch("".concat(this.url,"/cards"),{headers:{authorization:this.headers.authorization}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}loadData(){return Promise.all([this.loadUserInfo,this.getInitialCards])}editProfileData(e,t){return fetch("".concat(this.url,"/users/me"),{method:"PATCH",headers:{authorization:this.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}addNewCard(e,t){return fetch("".concat(this.url,"/cards"),{method:"POST",headers:{authorization:this.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}deleteCard(e){return fetch("".concat(this.url,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({likes:[],_id:e})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}likeCard(e){return fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:this.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}unlikeCard(e){return fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}changeProfileAvatar(e){return fetch("".concat(this.url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"82cfb778-0110-4074-beef-5e31af26dd47"}}),f=new s({items:[],renderer:e=>{q(e)}},".elements"),E=new class{constructor(e){let{userNameSelector:t,userJobSelector:s}=e;this._userName=document.querySelector(t),this._userJob=document.querySelector(s),this._userAvatar=document.querySelector(".profile__image")}getUserInfo(){return{userName:this._userName.textContent,userJob:this._userJob.textContent,userId:this._userId,userAvatar:this._userAvatar.src}}setUserInfo(e,t,s,n){this._userName.textContent=e,this._userJob.textContent=t,this._userId=s,this._userAvatar.src=n}}({userNameSelector:".profile__name",userJobSelector:".profile__interest"}),v=new i(".popup_type_confirm",(function(e,t,s){let{}=e;m.deleteCard(s).then((e=>{t.remove(),v.closePopup()})).catch((e=>console.log(e))).finally((()=>v.renderLoading(!1)))}));v.setEventListeners();const y=new i(".popup_type_avatar",(function(e){const{url:t}=e;m.changeProfileAvatar(t).then((e=>{E.setUserInfo(e.name,e.about,e._id,e.avatar),y.closePopup()})).catch((e=>console.log(e))).finally((()=>y.renderLoading(!1)))}));y.setEventListeners();const k=new class extends r{constructor(e){super(e)}closePopup(){super.closePopup()}openPopup(e,t){super.openPopup(),this._addImageAndCaption(e,t)}_addImageAndCaption(e,t){this._popupImageElement=document.querySelector(".popup__card-image"),this._popupNameElement=document.querySelector(".popup__name"),this._popupImageElement.src=e,this._popupImageElement.alt=t,this._popupNameElement.textContent=t}}(".popup_type_image");k.setEventListeners();const b=new i(".popup_type_card",(function(e){const{title:t,image_link:s}=e;m.addNewCard(t,s).then((e=>{q(e),b.closePopup()})).finally((()=>b.renderLoading(!1)))}));b.setEventListeners();const C=new i(".popup_type_profile",(function(e){const{name:t,hobby:s}=e;m.editProfileData(t,s).then((e=>{E.setUserInfo(e.name,e.about,e._id,e.avatar),C.closePopup()})).finally((()=>C.renderLoading(!1)))}));C.setEventListeners();const S=new t(d,h);S.enableValidation();const g=new t(d,_);function L(e,t,s){t?m.unlikeCard(e).then((e=>s(e.likes.length))):m.likeCard(e).then((e=>s(e.likes.length)))}function I(e,t){k.openPopup(e,t)}function P(e,t){v.setSubmitAction(e,t),v.openPopup()}function q(t){const s=new e(t,"#element",I,P,L,E.getUserInfo().userId).getCard();f.addItem(s)}g.enableValidation(),g.disableButton(),new t(d,c).enableValidation(),a.addEventListener("click",(()=>{b.openPopup(),S.disableButton()})),o.addEventListener("click",(()=>{C.openPopup(),function(){const{userName:e,userJob:t}=E.getUserInfo();l.value=e,u.value=t}()})),p.addEventListener("click",(()=>{y.openPopup()})),m.loadData(),m.loadUserInfo().then((e=>E.setUserInfo(e.name,e.about,e._id,e.avatar))).catch((e=>console.log(e))),m.getInitialCards().then((e=>{new s({items:e,renderer:e=>{q(e)}},".elements").renderItems()})).catch((e=>console.log(e)))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3RDOEosRUFBVXBGLFlBQ1YwRixFQUFrQjdILG1CQUlwQnFELEVBQWU1RixpQkFBaUIsU0FBUyxLQUN2Q2tLLEVBQWF4RixZQTRGZixXQUNFLE1BQU0sU0FBRWlFLEVBQUYsUUFBWUMsR0FBWVIsRUFBU00sY0FDdkM1QyxFQUFpQjdDLE1BQVEwRixFQUN6QjVDLEVBQWtCOUMsTUFBUTJGLEVBOUYxQitCLE1BaUdGeEUsRUFBd0JuRyxpQkFBaUIsU0FBUyxLQUNoRHdKLEVBQVk5RSxlQUdkMEIsRUFBSWUsV0FFSmYsRUFDR0ksZUFDQUcsTUFBTXVDLEdBQ0xkLEVBQVNVLFlBQVlJLEVBQU94TCxLQUFNd0wsRUFBTzVCLE1BQU80QixFQUFPckwsSUFBS3FMLEVBQU9sQixVQUVwRW1CLE9BQU9DLEdBQVFDLFFBQVFDLElBQUlGLEtBRzlCaEQsRUFDR2Msa0JBQ0FQLE1BQU11QyxJQUNtQixJQUFJM0YsRUFDMUIsQ0FDRUUsTUFBT3lGLEVBQ1B4RixTQUFXd0UsSUFDVEMsRUFBV0QsS0FHZixhQUdjbEUsaUJBRWpCbUYsT0FBT0MsR0FBUUMsUUFBUUMsSUFBSUYsSyIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BUEkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHsgbmFtZSwgbGluaywgbGlrZXMsIF9pZCwgb3duZXIgfSxcclxuICAgIHRlbXBsYXRlU2VsZWN0b3IsXHJcbiAgICBoYW5kbGVDYXJkQ2xpY2ssXHJcbiAgICBoYW5kbGVEZWxldGVDbGljayxcclxuICAgIGhhbmRsZUxpa2VDbGljayxcclxuICAgIHVzZXJJZFxyXG4gICkge1xyXG4gICAgdGhpcy5fb3duZXIgPSBvd25lcjtcclxuICAgIHRoaXMuX25hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGxpbms7XHJcbiAgICB0aGlzLl90ZW1wbGF0ZVNlbGVjdG9yID0gdGVtcGxhdGVTZWxlY3RvcjtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrID0gaGFuZGxlRGVsZXRlQ2xpY2s7XHJcbiAgICB0aGlzLl9oYW5kbGVIZWFydENsaWNrID0gaGFuZGxlTGlrZUNsaWNrO1xyXG4gICAgdGhpcy5fY2FyZElkID0gX2lkO1xyXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG4gICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcclxuICAgIHRoaXMuX2xpa2VzTnVtID0gbGlrZXMgPyBsaWtlcy5sZW5ndGggOiAwO1xyXG4gIH1cclxuXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX3RlbXBsYXRlU2VsZWN0b3IpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudFwiKVxyXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUltYWdlQ2xpY2soZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayhldnQudGFyZ2V0LnNyYywgdGhpcy5fbmFtZSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRGVsZXRlSWNvbkNsaWNrKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKGVsZW1lbnQsIHRoaXMuX2NhcmRJZCk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlTGlrZUNsaWNrKGV2dCkge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoXCJlbGVtZW50X19saWtlX2FjdGl2ZVwiKTtcclxuICAgIHRoaXMuX2hhbmRsZUhlYXJ0Q2xpY2soXHJcbiAgICAgIHRoaXMuX2NhcmRJZCxcclxuICAgICAgIWV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZWxlbWVudF9fbGlrZV9hY3RpdmVcIiksXHJcbiAgICAgIHRoaXMuX3VwZGF0ZUNhcmQuYmluZCh0aGlzKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT5cclxuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayhldnQpXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuX2RlbGV0ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVJY29uQ2xpY2sodGhpcy5fZGVsZXRlRWxlbWVudC5jbG9zZXN0KFwiLmVsZW1lbnRcIikpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl9saWtlcy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XHJcbiAgICAgIGlmIChlbGVtZW50Ll9pZCA9PT0gdGhpcy5fdXNlcklkKSB7XHJcbiAgICAgICAgdGhpcy5fbGlrZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImVsZW1lbnRfX2xpa2VfYWN0aXZlXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9saWtlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT5cclxuICAgICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrKGV2dClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRDYXJkKCkge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcblxyXG4gICAgdGhpcy5faW1hZ2VFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSB0aGlzLl9lbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2JveFwiKVxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19uYW1lXCIpO1xyXG4gICAgdGhpcy5fZGVsZXRlRWxlbWVudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIuZWxlbWVudF9fZGVsZXRlLWJ1dHRvblwiXHJcbiAgICApO1xyXG4gICAgdGhpcy5fbGlrZUVsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZVwiKTtcclxuICAgIHRoaXMuX2xpa2VzTnVtRWxlbWVudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19jb3VudFwiKTtcclxuXHJcbiAgICBpZiAodGhpcy5fdXNlcklkID09PSB0aGlzLl9vd25lci5faWQpIHtcclxuICAgICAgdGhpcy5fZGVsZXRlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9pbWFnZUVsZW1lbnQuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5hbHQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fbGlrZXNOdW1FbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXNOdW07XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG4gIF91cGRhdGVDYXJkKGxpa2VOdW0pIHtcclxuICAgIHRoaXMuX2xpa2VzTnVtID0gbGlrZU51bTtcclxuICAgIHRoaXMuX2xpa2VzTnVtRWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzTnVtO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2Zvcm1TZWxlY3RvciA9IHNldHRpbmdzLmZvcm1TZWxlY3RvcjtcclxuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBzZXR0aW5ncy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xyXG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICk7XHJcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgdGhpcy5fZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgdGhpcy5fZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBkaXNhYmxlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfZW5hYmxlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSWZWYWxpZChpbnB1dEVsZW1lbnQpIHtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJZkZvcm1WYWxpZCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9pbnB1dHNMaXN0LmV2ZXJ5KChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgcmV0dXJuIGlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCAmJiBpbnB1dEVsZW1lbnQudmFsdWUgIT09IFwiXCI7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVTdWJtaXRCdG5TdGF0ZSgpIHtcclxuICAgIGlmICh0aGlzLl9jaGVja0lmRm9ybVZhbGlkKCkpIHtcclxuICAgICAgdGhpcy5fZW5hYmxlQnV0dG9uKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRpc2FibGVCdXR0b24oKTtcclxuICAgIH1cclxuICB9XHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5faW5wdXRzTGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5faW5wdXRzTGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnRuU3RhdGUoKTtcclxuICAgICAgICB0aGlzLl9jaGVja0lmVmFsaWQoaW5wdXRFbGVtZW50KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlID0gKGV2dCkgPT4ge1xyXG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZVBvcHVwKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY2xvc2VQb3B1cCgpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB0aGlzLl9wb3B1cC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlT3ZlcmxheUNsaWNrKTtcclxuICB9XHJcblxyXG4gIG9wZW5Qb3B1cCgpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlT3ZlcmxheUNsaWNrKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVPdmVybGF5Q2xpY2sgPSAoZXZ0KSA9PiB7XHJcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cFwiKSkge1xyXG4gICAgICB0aGlzLmNsb3NlUG9wdXAoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBfYWRkQ2xvc2VPbkNsaWNrRXZlbnQoKSB7XHJcbiAgICB0aGlzLl9jbG9zZUJ0biA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlXCIpO1xyXG4gICAgdGhpcy5fY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMuY2xvc2VQb3B1cCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2FkZENsb3NlT25DbGlja0V2ZW50KCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XHJcbiAgICB0aGlzLl9idXR0b25WYWx1ZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvblwiKS52YWx1ZTtcclxuICB9XHJcblxyXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgIC8vIEdldCBhbGwgZmllbGQgZWxlbWVudHNcclxuXHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYW4gZW1wdHkgb2JqZWN0XHJcbiAgICB0aGlzLl9mb3JtVmFsdWVzID0ge307XHJcblxyXG4gICAgLy8gQWRkIHRoZSB2YWx1ZXMgb2YgdGhlIGZpZWxkcyB0byB0aGlzIG9iamVjdFxyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIHRoaXMuX2Zvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFJldHVybiB0aGUgdmFsdWVzIG9iamVjdFxyXG4gICAgcmV0dXJuIHRoaXMuX2Zvcm1WYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICAvLyBjYWxsIGhhbmRsZUZvcm1TdWJtaXQgYW5kIHBhc3MgdGhlIHJlc3VsdCBvZiBnZXRJbnB1dFZhbHVlcygpXHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLnJlbmRlckxvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSwgdGhpcy5fZWxlbWVudCwgdGhpcy5faWQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRTdWJtaXRBY3Rpb24oZWxlbWVudCwgaWQpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgdGhpcy5faWQgPSBpZDtcclxuICB9XHJcblxyXG4gIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKSB7XHJcbiAgICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICAgIHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvblwiKS52YWx1ZSA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idXR0b25cIikudmFsdWUgPSB0aGlzLl9idXR0b25WYWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsb3NlUG9wdXAoKSB7XHJcbiAgICBzdXBlci5jbG9zZVBvcHVwKCk7XHJcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcbiIsImNvbnN0IHByb2ZpbGVFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuY29uc3QgcHJvZmlsZUFkZEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVJbnB1dE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX25hbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVJbnB1dEhvYmJ5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfdHlwZV9ob2JieVwiKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVQb3B1cEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfcHJvZmlsZVwiKTtcclxuY29uc3QgY2FyZFBvcHVwRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fdHlwZV9jYXJkXCIpO1xyXG5jb25zdCBhdmF0YXJQb3B1cEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfYXZhdGFyXCIpO1xyXG5cclxuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVJbnRlcmVzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW50ZXJlc3RcIik7XHJcblxyXG5jb25zdCBwcm9maWxlT3ZlcmxheUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIucHJvZmlsZV9fb3ZlcmxheS1jb250YWluZXJcIlxyXG4pO1xyXG5cclxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXHJcbiAgfSxcclxuXTtcclxuXHJcbi8vIHNldHRpbmdzIGZvciB2YWxpZGF0aW9uXHJcbmNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxyXG4gIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIixcclxufTtcclxuXHJcbmV4cG9ydCB7XHJcbiAgcHJvZmlsZUlucHV0TmFtZSxcclxuICBwcm9maWxlSW5wdXRIb2JieSxcclxuICBjYXJkUG9wdXBGb3JtLFxyXG4gIHByb2ZpbGVQb3B1cEZvcm0sXHJcbiAgaW5pdGlhbENhcmRzLFxyXG4gIHByb2ZpbGVBZGRCdG4sXHJcbiAgcHJvZmlsZUVkaXRCdG4sXHJcbiAgcHJvZmlsZU5hbWUsXHJcbiAgcHJvZmlsZUludGVyZXN0LFxyXG4gIHNldHRpbmdzLFxyXG4gIHByb2ZpbGVPdmVybGF5Q29udGFpbmVyLFxyXG4gIGF2YXRhclBvcHVwRm9ybSxcclxufTtcclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuXHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgQVBJIGZyb20gXCIuLy4uL2NvbXBvbmVudHMvQVBJXCI7XHJcbmltcG9ydCB7XHJcbiAgcHJvZmlsZUlucHV0TmFtZSxcclxuICBwcm9maWxlSW5wdXRIb2JieSxcclxuICBwcm9maWxlQWRkQnRuLFxyXG4gIHByb2ZpbGVQb3B1cEZvcm0sXHJcbiAgcHJvZmlsZUVkaXRCdG4sXHJcbiAgY2FyZFBvcHVwRm9ybSxcclxuICBzZXR0aW5ncyxcclxuICBwcm9maWxlT3ZlcmxheUNvbnRhaW5lcixcclxuICBhdmF0YXJQb3B1cEZvcm0sXHJcbn0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5cclxuLy8gQVBJXHJcbmNvbnN0IGFwaSA9IG5ldyBBUEkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiODJjZmI3NzgtMDExMC00MDc0LWJlZWYtNWUzMWFmMjZkZDQ3XCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG4vLyBlbGVtZW50cyBzZWN0aW9uIGluc3RhbmNlXHJcbmNvbnN0IGVsZW1lbnRzU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxyXG4gIHtcclxuICAgIGl0ZW1zOiBbXSxcclxuICAgIHJlbmRlcmVyOiAoY2FyZEl0ZW0pID0+IHtcclxuICAgICAgcmVuZGVyQ2FyZChjYXJkSXRlbSk7XHJcbiAgICB9LFxyXG4gIH0sXHJcbiAgXCIuZWxlbWVudHNcIlxyXG4pO1xyXG5cclxuLy8gdXNlckluZm9cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIHVzZXJOYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcclxuICB1c2VySm9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2ludGVyZXN0XCIsXHJcbn0pO1xyXG5cclxuY29uc3QgY29uZmlybURlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIucG9wdXBfdHlwZV9jb25maXJtXCIsXHJcbiAgaGFuZGxlQ29uZmlybUZvcm1TdWJtaXRcclxuKTtcclxuY29uZmlybURlbGV0ZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vLyBhdmF0YXIgcG9wdXBcclxuY29uc3QgYXZhdGFyUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIi5wb3B1cF90eXBlX2F2YXRhclwiLFxyXG4gIGhhbmRsZUF2YXRhclBpY3R1cmVTdWJtaXRcclxuKTtcclxuYXZhdGFyUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vIGNhcmQgd2l0aCBpbWFnZSBwb3B1cCBpbnN0YW5jZVxyXG5jb25zdCBjYXJkSW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF90eXBlX2ltYWdlXCIpO1xyXG5jYXJkSW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy8gY2FyZCBwb3B1cCBpbnN0YW5jZSBvZiB0aGUgUG9wdXBXaXRoRm9ybSBjbGFzc1xyXG5jb25zdCBjYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cF90eXBlX2NhcmRcIiwgaGFuZGxlQ2FyZEZvcm1TdWJtaXQpO1xyXG5jYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vIHByb2ZpbGUgcG9wdXAgaW5zdGFuY2Ugb2YgdGhlIFBvcHVwV2l0aEZvcm0gY2xhc3NcclxuY29uc3QgcHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIucG9wdXBfdHlwZV9wcm9maWxlXCIsXHJcbiAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXRcclxuKTtcclxucHJvZmlsZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vLyBjYXJkIGZvcm0gdmFsaWRhdG9yXHJcbmNvbnN0IGNhcmRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGNhcmRQb3B1cEZvcm0pO1xyXG5jYXJkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG4vLyBhdmF0YXIgZm9ybSB2YWxpZGF0b3JcclxuY29uc3QgYXZhdGFydEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgYXZhdGFyUG9wdXBGb3JtKTtcclxuYXZhdGFydEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5hdmF0YXJ0Rm9ybVZhbGlkYXRvci5kaXNhYmxlQnV0dG9uKCk7XHJcblxyXG4vLyBwcm9maWxlIGZvcm0gdmFsaWRhdG9yXHJcbmNvbnN0IHByb2ZpbGVGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIHByb2ZpbGVQb3B1cEZvcm0pO1xyXG5wcm9maWxlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG4vLyBhZGQgYSBjbGljayBldmVudCBsaXN0ZW5lciBmb3IgdGhlIGFkZCBidXR0b25cclxucHJvZmlsZUFkZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNhcmRQb3B1cC5vcGVuUG9wdXAoKTtcclxuICBjYXJkRm9ybVZhbGlkYXRvci5kaXNhYmxlQnV0dG9uKCk7XHJcbn0pO1xyXG5cclxuLy8gYWRkIGEgY2xpY2sgZXZlbnQgbGlzdGVuZXIgZm9yIHRoZSBlZGl0IGJ1dHRvblxyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIHByb2ZpbGVQb3B1cC5vcGVuUG9wdXAoKTtcclxuICBmaWxsUHJvZmlsZUlucHV0cygpO1xyXG59KTtcclxuXHJcbi8vIGF2YXRhciBmb3JtIHN1Ym1pdCBoYW5kbGVyXHJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclBpY3R1cmVTdWJtaXQoZGF0YSkge1xyXG4gIGNvbnN0IHsgdXJsIH0gPSBkYXRhO1xyXG5cclxuICBhcGlcclxuICAgIC5jaGFuZ2VQcm9maWxlQXZhdGFyKHVybClcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzLm5hbWUsIHJlcy5hYm91dCwgcmVzLl9pZCwgcmVzLmF2YXRhcik7XHJcbiAgICAgIGF2YXRhclBvcHVwLmNsb3NlUG9wdXAoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IGF2YXRhclBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKTtcclxufVxyXG5cclxuLy8gY2FyZCBmb3JtIHN1Ym1pdCBoYW5kbGVyXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRGb3JtU3VibWl0KGRhdGEpIHtcclxuICBjb25zdCB7IHRpdGxlLCBpbWFnZV9saW5rIH0gPSBkYXRhO1xyXG5cclxuICAvLyBhZGQgYSBuZXcgY2FyZCB0byB0aGUgc2VydmVyXHJcbiAgYXBpXHJcbiAgICAuYWRkTmV3Q2FyZCh0aXRsZSwgaW1hZ2VfbGluaylcclxuICAgIC50aGVuKChjYXJkKSA9PiB7XHJcbiAgICAgIHJlbmRlckNhcmQoY2FyZCk7XHJcbiAgICAgIGNhcmRQb3B1cC5jbG9zZVBvcHVwKCk7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4gY2FyZFBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKTtcclxufVxyXG5cclxuLy8gbGlrZSBjbGljayBoYW5kbGVyXHJcbmZ1bmN0aW9uIGhhbmRsZUxpa2VDbGljayhpZCwgbGlrZWQsIHVwZGF0ZUNhcmQpIHtcclxuICBpZiAobGlrZWQpIHtcclxuICAgIGFwaS51bmxpa2VDYXJkKGlkKS50aGVuKChkYXRhKSA9PiB1cGRhdGVDYXJkKGRhdGEubGlrZXMubGVuZ3RoKSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFwaS5saWtlQ2FyZChpZCkudGhlbigoZGF0YSkgPT4gdXBkYXRlQ2FyZChkYXRhLmxpa2VzLmxlbmd0aCkpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gcHJvZmlsZSBmb3JtIHN1Ym1pdCBoYW5kbGVyXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGRhdGEpIHtcclxuICBjb25zdCB7IG5hbWUsIGhvYmJ5IH0gPSBkYXRhO1xyXG5cclxuICAvLyB1cGFkdGUgcHJvZmlsZSBkYXRhIGluIHRoZSBzZXJ2ZXJcclxuICBhcGlcclxuICAgIC5lZGl0UHJvZmlsZURhdGEobmFtZSwgaG9iYnkpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcy5uYW1lLCByZXMuYWJvdXQsIHJlcy5faWQsIHJlcy5hdmF0YXIpO1xyXG4gICAgICBwcm9maWxlUG9wdXAuY2xvc2VQb3B1cCgpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHByb2ZpbGVQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKSk7XHJcbn1cclxuLy8gZGVsZXRlIGEgY2FyZFxyXG5mdW5jdGlvbiBoYW5kbGVDb25maXJtRm9ybVN1Ym1pdCh7fSwgZWxlbWVudCwgaWQpIHtcclxuICBhcGlcclxuICAgIC5kZWxldGVDYXJkKGlkKVxyXG4gICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICBjb25maXJtRGVsZXRlUG9wdXAuY2xvc2VQb3B1cCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4gY29uZmlybURlbGV0ZVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKTtcclxufVxyXG5cclxuLy8gY2FyZCBjbGljayBoYW5kbGVyXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmRDbGljayhzcmMsIG5hbWUpIHtcclxuICBjYXJkSW1hZ2VQb3B1cC5vcGVuUG9wdXAoc3JjLCBuYW1lKTtcclxufVxyXG5cclxuLy8gb3BlbiBjb25maXJtIHBvcHVwXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUljb25DbGljayhlbGVtZW50LCBpZCkge1xyXG4gIGNvbmZpcm1EZWxldGVQb3B1cC5zZXRTdWJtaXRBY3Rpb24oZWxlbWVudCwgaWQpO1xyXG4gIGNvbmZpcm1EZWxldGVQb3B1cC5vcGVuUG9wdXAoKTtcclxufVxyXG5cclxuLy8gcmVuZGVyaW5nIGEgY2FyZFxyXG5mdW5jdGlvbiByZW5kZXJDYXJkKGNhcmREYXRhKSB7XHJcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxyXG4gICAgY2FyZERhdGEsXHJcbiAgICBcIiNlbGVtZW50XCIsXHJcbiAgICBoYW5kbGVDYXJkQ2xpY2ssXHJcbiAgICBoYW5kbGVEZWxldGVJY29uQ2xpY2ssXHJcbiAgICBoYW5kbGVMaWtlQ2xpY2ssXHJcbiAgICB1c2VySW5mby5nZXRVc2VySW5mbygpLnVzZXJJZFxyXG4gICk7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdldENhcmQoKTtcclxuICBlbGVtZW50c1NlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbn1cclxuXHJcbi8vIGEgZnVuY3Rpb24gdG8gZmlsbCB0aGUgaW5wdXRzIGFmdGVyIHJlc2V0dGluZyB0aGUgcHJvZmlsZSBmb3JtXHJcbmZ1bmN0aW9uIGZpbGxQcm9maWxlSW5wdXRzKCkge1xyXG4gIGNvbnN0IHsgdXNlck5hbWUsIHVzZXJKb2IgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgcHJvZmlsZUlucHV0TmFtZS52YWx1ZSA9IHVzZXJOYW1lO1xyXG4gIHByb2ZpbGVJbnB1dEhvYmJ5LnZhbHVlID0gdXNlckpvYjtcclxufVxyXG5cclxucHJvZmlsZU92ZXJsYXlDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhdmF0YXJQb3B1cC5vcGVuUG9wdXAoKTtcclxufSk7XHJcblxyXG5hcGkubG9hZERhdGEoKTtcclxuLy8gc2V0IHVzZXJJbmZvIGZyb20gdGhlIHNlcnZlciByZXNwb25zZVxyXG5hcGlcclxuICAubG9hZFVzZXJJbmZvKClcclxuICAudGhlbigocmVzdWx0KSA9PlxyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzdWx0Lm5hbWUsIHJlc3VsdC5hYm91dCwgcmVzdWx0Ll9pZCwgcmVzdWx0LmF2YXRhcilcclxuICApXHJcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG5cclxuLy8gc2V0IGluaXRpYWxDYXJkcyBiYXNlZCBvbiB0aGUgc2VydmVyIHJlc3BvbnNlXHJcbmFwaVxyXG4gIC5nZXRJbml0aWFsQ2FyZHMoKVxyXG4gIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgIGNvbnN0IGVsZW1lbnRzU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxyXG4gICAgICB7XHJcbiAgICAgICAgaXRlbXM6IHJlc3VsdCxcclxuICAgICAgICByZW5kZXJlcjogKGNhcmRJdGVtKSA9PiB7XHJcbiAgICAgICAgICByZW5kZXJDYXJkKGNhcmRJdGVtKTtcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgICBcIi5lbGVtZW50c1wiXHJcbiAgICApO1xyXG4gICAgLy8gdG8gYWRkIG1hcmt1cCB0byB0aGUgZG9tXHJcbiAgICBlbGVtZW50c1NlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQVBJIHtcclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy51cmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIGxvYWRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLnVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogdGhpcy5oZWFkZXJzLmF1dGhvcml6YXRpb24gfSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy51cmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IHRoaXMuaGVhZGVycy5hdXRob3JpemF0aW9uIH0sXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbG9hZERhdGEoKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMubG9hZFVzZXJJbmZvLCB0aGlzLmdldEluaXRpYWxDYXJkc10pO1xyXG4gIH1cclxuXHJcbiAgZWRpdFByb2ZpbGVEYXRhKG5hbWUsIGFib3V0KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy51cmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuaGVhZGVycy5hdXRob3JpemF0aW9uLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBhYm91dDogYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZE5ld0NhcmQobmFtZSwgbGluaykge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMudXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuaGVhZGVycy5hdXRob3JpemF0aW9uLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy51cmx9L2NhcmRzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLmhlYWRlcnMuYXV0aG9yaXphdGlvbixcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGxpa2VzOiBbXSxcclxuICAgICAgICBfaWQ6IGlkLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsaWtlQ2FyZChpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMudXJsfS9jYXJkcy9saWtlcy8ke2lkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5oZWFkZXJzLmF1dGhvcml6YXRpb24sXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBfaWQ6IGlkLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHVubGlrZUNhcmQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLnVybH0vY2FyZHMvbGlrZXMvJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuaGVhZGVycy5hdXRob3JpemF0aW9uLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgX2lkOiBpZCxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBjaGFuZ2VQcm9maWxlQXZhdGFyKGxpbmspIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLnVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuaGVhZGVycy5hdXRob3JpemF0aW9uLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgYXZhdGFyOiBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih7IHVzZXJOYW1lU2VsZWN0b3IsIHVzZXJKb2JTZWxlY3RvciB9KSB7XHJcbiAgICB0aGlzLl91c2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl91c2VySm9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VySm9iU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fdXNlckF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VcIik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHVzZXJOYW1lOiB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCxcclxuICAgICAgdXNlckpvYjogdGhpcy5fdXNlckpvYi50ZXh0Q29udGVudCxcclxuICAgICAgdXNlcklkOiB0aGlzLl91c2VySWQsXHJcbiAgICAgIHVzZXJBdmF0YXI6IHRoaXMuX3VzZXJBdmF0YXIuc3JjLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKG5hbWUsIGpvYiwgaWQsIHByb2ZpbGVJbWFnZUxpbmspIHtcclxuICAgIHRoaXMuX3VzZXJOYW1lLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX3VzZXJKb2IudGV4dENvbnRlbnQgPSBqb2I7XHJcbiAgICB0aGlzLl91c2VySWQgPSBpZDtcclxuICAgIHRoaXMuX3VzZXJBdmF0YXIuc3JjID0gcHJvZmlsZUltYWdlTGluaztcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5jbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGNsb3NlUG9wdXAoKSB7XHJcbiAgICBzdXBlci5jbG9zZVBvcHVwKCk7XHJcbiAgfVxyXG5cclxuICBvcGVuUG9wdXAoc3JjLCBuYW1lKSB7XHJcbiAgICBzdXBlci5vcGVuUG9wdXAoKTtcclxuICAgIHRoaXMuX2FkZEltYWdlQW5kQ2FwdGlvbihzcmMsIG5hbWUpO1xyXG4gIH1cclxuXHJcbiAgX2FkZEltYWdlQW5kQ2FwdGlvbihzcmMsIG5hbWUpIHtcclxuICAgIHRoaXMuX3BvcHVwSW1hZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2FyZC1pbWFnZVwiKTtcclxuICAgIHRoaXMuX3BvcHVwTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19uYW1lXCIpO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZUVsZW1lbnQuc3JjID0gc3JjO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZUVsZW1lbnQuYWx0ID0gbmFtZTtcclxuICAgIHRoaXMuX3BvcHVwTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoSW1hZ2U7XHJcbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJ0ZW1wbGF0ZVNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJoYW5kbGVMaWtlQ2xpY2siLCJ1c2VySWQiLCJuYW1lIiwibGluayIsImxpa2VzIiwiX2lkIiwib3duZXIiLCJ0aGlzIiwiX293bmVyIiwiX25hbWUiLCJfbGluayIsIl90ZW1wbGF0ZVNlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVEZWxldGVDbGljayIsIl9oYW5kbGVIZWFydENsaWNrIiwiX2NhcmRJZCIsIl91c2VySWQiLCJfbGlrZXMiLCJfbGlrZXNOdW0iLCJsZW5ndGgiLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInRhcmdldCIsInNyYyIsIl9oYW5kbGVEZWxldGVJY29uQ2xpY2siLCJlbGVtZW50IiwiX2hhbmRsZUxpa2VDbGljayIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImNvbnRhaW5zIiwiX3VwZGF0ZUNhcmQiLCJiaW5kIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX2ltYWdlRWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfZGVsZXRlRWxlbWVudCIsImNsb3Nlc3QiLCJmb3JFYWNoIiwiX2xpa2VFbGVtZW50IiwiYWRkIiwiZ2V0Q2FyZCIsIl9lbGVtZW50IiwiX25hbWVFbGVtZW50IiwiX2xpa2VzTnVtRWxlbWVudCIsInN0eWxlIiwidmlzaWJpbGl0eSIsImFsdCIsInRleHRDb250ZW50IiwibGlrZU51bSIsIkZvcm1WYWxpZGF0b3IiLCJzZXR0aW5ncyIsImZvcm1FbGVtZW50IiwiX2Zvcm1TZWxlY3RvciIsImZvcm1TZWxlY3RvciIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9mb3JtRWxlbWVudCIsIl9idXR0b25FbGVtZW50IiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiX2Vycm9yRWxlbWVudCIsImlkIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiX2VuYWJsZUJ1dHRvbiIsIl9jaGVja0lmVmFsaWQiLCJ2YWxpZGl0eSIsInZhbGlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfY2hlY2tJZkZvcm1WYWxpZCIsIl9pbnB1dHNMaXN0IiwiZXZlcnkiLCJ2YWx1ZSIsIl90b2dnbGVTdWJtaXRCdG5TdGF0ZSIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbmFibGVWYWxpZGF0aW9uIiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwicHJlcGVuZCIsInJlbmRlckl0ZW1zIiwiaXRlbSIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImtleSIsImNsb3NlUG9wdXAiLCJfcG9wdXAiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiX2hhbmRsZUVzY0Nsb3NlIiwiX2hhbmRsZU92ZXJsYXlDbGljayIsIm9wZW5Qb3B1cCIsIl9hZGRDbG9zZU9uQ2xpY2tFdmVudCIsIl9jbG9zZUJ0biIsInNldEV2ZW50TGlzdGVuZXJzIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm0iLCJfYnV0dG9uVmFsdWUiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfaW5wdXRMaXN0IiwiX2Zvcm1WYWx1ZXMiLCJpbnB1dCIsInJlbmRlckxvYWRpbmciLCJzZXRTdWJtaXRBY3Rpb24iLCJpc0xvYWRpbmciLCJyZXNldCIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZUFkZEJ0biIsInByb2ZpbGVJbnB1dE5hbWUiLCJwcm9maWxlSW5wdXRIb2JieSIsInByb2ZpbGVQb3B1cEZvcm0iLCJjYXJkUG9wdXBGb3JtIiwiYXZhdGFyUG9wdXBGb3JtIiwicHJvZmlsZU92ZXJsYXlDb250YWluZXIiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsInVybCIsImxvYWRVc2VySW5mbyIsImZldGNoIiwiYXV0aG9yaXphdGlvbiIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0SW5pdGlhbENhcmRzIiwibG9hZERhdGEiLCJhbGwiLCJlZGl0UHJvZmlsZURhdGEiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYWRkTmV3Q2FyZCIsImRlbGV0ZUNhcmQiLCJsaWtlQ2FyZCIsInVubGlrZUNhcmQiLCJjaGFuZ2VQcm9maWxlQXZhdGFyIiwiYXZhdGFyIiwiZWxlbWVudHNTZWN0aW9uIiwiY2FyZEl0ZW0iLCJyZW5kZXJDYXJkIiwidXNlckluZm8iLCJ1c2VyTmFtZVNlbGVjdG9yIiwidXNlckpvYlNlbGVjdG9yIiwiX3VzZXJOYW1lIiwiX3VzZXJKb2IiLCJfdXNlckF2YXRhciIsImdldFVzZXJJbmZvIiwidXNlck5hbWUiLCJ1c2VySm9iIiwidXNlckF2YXRhciIsInNldFVzZXJJbmZvIiwiam9iIiwicHJvZmlsZUltYWdlTGluayIsImNvbmZpcm1EZWxldGVQb3B1cCIsInJlc3VsdCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImZpbmFsbHkiLCJhdmF0YXJQb3B1cCIsImRhdGEiLCJjYXJkSW1hZ2VQb3B1cCIsIl9hZGRJbWFnZUFuZENhcHRpb24iLCJfcG9wdXBJbWFnZUVsZW1lbnQiLCJfcG9wdXBOYW1lRWxlbWVudCIsImNhcmRQb3B1cCIsInRpdGxlIiwiaW1hZ2VfbGluayIsImNhcmQiLCJwcm9maWxlUG9wdXAiLCJob2JieSIsImNhcmRGb3JtVmFsaWRhdG9yIiwiYXZhdGFydEZvcm1WYWxpZGF0b3IiLCJsaWtlZCIsInVwZGF0ZUNhcmQiLCJoYW5kbGVEZWxldGVJY29uQ2xpY2siLCJjYXJkRGF0YSIsImNhcmRFbGVtZW50IiwiZmlsbFByb2ZpbGVJbnB1dHMiXSwic291cmNlUm9vdCI6IiJ9